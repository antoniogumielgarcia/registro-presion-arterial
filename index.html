<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Presi贸n Arterial</title>
    <!-- Carga de Librer铆as -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        .google-icon { width: 20px; height: 20px; margin-right: 10px; display: inline-block; }
        #bpChart { height: 320px; }
        /* Transici贸n para ocultar/mostrar secciones */
        .hidden-transition { opacity: 0; transition: opacity 0.5s ease-in-out; }
    </style>

    <!-- Carga e Inicializaci贸n de Firebase -->
    <script type="module">
        // ======================================================================================
        //  !!! INSTRUCCIN CRTICA: REEMPLAZA ESTA CONFIGURACIN CON TUS CLAVES REALES DE FIREBASE !!!
        //  Si estos valores son incorrectos o faltan, la aplicaci贸n fallar谩 y se ver谩 en blanco.
        // ======================================================================================
        const FIREBASE_CONFIG = {
            apiKey: "TU_API_KEY_DE_FIREBASE_AQUI", // <--- REEMPLAZAR
            authDomain: "tu-dominio.firebaseapp.com", // <--- REEMPLAZAR
            projectId: "tu-project-id", // <--- REEMPLAZAR
            storageBucket: "tu-project-id.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890"
        };
        const CANVAS_APP_ID = "bp-tracker-pro"; // ID de la app para la ruta de datos
        // ======================================================================================
        //  !!! FIN DE LA CONFIGURACIN CRTICA !!!
        // ======================================================================================

        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup,
            createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, doc, addDoc, deleteDoc, onSnapshot, collection, query, 
            orderBy, Timestamp
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        let db, auth, userId;
        let readingsListener = null;
        let bpChart = null;
        let currentReadings = [];

        // Elementos del DOM
        let form, historyContainer, loadingIndicator, errorMessage, successMessage;
        let authSection, appContent, signOutBtn, userEmailDisplay;
        let emailForm, googleSignInBtn, switchAuthBtn, authTitle;

        // --- INICIALIZACIN DE LA APP ---
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Verificar que las claves cr铆ticas hayan sido reemplazadas (check simple)
                if (FIREBASE_CONFIG.apiKey.includes("TU_API_KEY_DE_FIREBASE_AQUI")) {
                    // Si falla aqu铆, muestra un mensaje de error directo al usuario en el body
                    document.body.innerHTML = `
                        <div class="p-8 text-center bg-red-100 text-red-700">
                            <h1 class="text-2xl font-bold mb-4">隆ERROR CRTICO! La aplicaci贸n no puede iniciar.</h1>
                            <p class="mb-2">1. Aseg煤rate de haber reemplazado todas las claves en el c贸digo fuente de tu ${document.title} con tus credenciales de Firebase.</p>
                            <p>2. Si ya lo hiciste y sigue fallando, verifica que los servicios de Firebase (Authentication y Firestore) est茅n habilitados en tu consola.</p>
                        </div>
                    `;
                    throw new Error("Claves de Firebase no reemplazadas. La app no puede conectarse.");
                }

                const app = initializeApp(FIREBASE_CONFIG);
                db = getFirestore(app);
                auth = getAuth(app);
                
                cacheDOMElements();
                setupEventListeners();
                setupAuthListener();

            } catch (error) {
                console.error("Error cr铆tico de inicializaci贸n:", error);
                // El error se maneja en el bloque de arriba si es por credenciales.
            }
        });

        // --- Funciones auxiliares para el DOM, Autenticaci贸n y CRUD (Detalles dentro del archivo) ---
        function cacheDOMElements() {
            form = document.getElementById('bp-form');
            historyContainer = document.getElementById('history-container');
            loadingIndicator = document.getElementById('loading');
            errorMessage = document.getElementById('error-message');
            successMessage = document.getElementById('success-message');

            authSection = document.getElementById('auth-section');
            appContent = document.getElementById('app-content');
            signOutBtn = document.getElementById('sign-out-btn');
            userEmailDisplay = document.getElementById('user-email-display');
            emailForm = document.getElementById('email-auth-form');
            googleSignInBtn = document.getElementById('google-sign-in-btn');
            switchAuthBtn = document.getElementById('switch-auth-btn');
            authTitle = document.getElementById('auth-title');

            setDefaultDateTime();
        }

        function setupEventListeners() {
            form.addEventListener('submit', handleSaveReading);
            historyContainer.addEventListener('click', (e) => {
                if (e.target.closest('.delete-btn')) {
                    const id = e.target.closest('.delete-btn').dataset.id;
                    handleDeleteReading(id);
                }
            });
            document.getElementById('export-pdf-btn').addEventListener('click', handleExportPDF);
            document.getElementById('add-to-calendar-btn').addEventListener('click', handleAddToGoogleCalendar);
            signOutBtn.addEventListener('click', handleSignOut);
            googleSignInBtn.addEventListener('click', handleGoogleSignIn);
            emailForm.addEventListener('submit', handleEmailAuth);
            switchAuthBtn.addEventListener('click', switchAuthMode);
        }

        let isSignInMode = true;

        function switchAuthMode() {
            isSignInMode = !isSignInMode;
            if (isSignInMode) {
                authTitle.textContent = 'Inicia Sesi贸n';
                switchAuthBtn.textContent = '驴No tienes cuenta? Reg铆strate aqu铆.';
                document.getElementById('email-auth-submit').textContent = 'Iniciar Sesi贸n';
            } else {
                authTitle.textContent = 'Reg铆strate';
                switchAuthBtn.textContent = '驴Ya tienes cuenta? Inicia Sesi贸n aqu铆.';
                document.getElementById('email-auth-submit').textContent = 'Registrarse';
            }
        }

        function setupAuthListener() {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    userEmailDisplay.textContent = user.email || 'ID de Usuario (sin correo)';
                    
                    authSection.classList.add('hidden-transition');
                    setTimeout(() => {
                        authSection.classList.add('hidden');
                        appContent.classList.remove('hidden');
                        appContent.classList.remove('hidden-transition');
                    }, 500);

                    setupReadingsListener();
                } else {
                    userId = null;
                    if (readingsListener) { readingsListener(); readingsListener = null; }
                    currentReadings = [];
                    renderReadings([]);
                    updateChart([]);
                    
                    appContent.classList.add('hidden-transition');
                    setTimeout(() => {
                        appContent.classList.add('hidden');
                        authSection.classList.remove('hidden');
                        authSection.classList.remove('hidden-transition');
                    }, 500);
                    loadingIndicator.classList.add('hidden');
                }
            });
        }

        async function handleGoogleSignIn() {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
                showSuccess("Inicio de sesi贸n con Google exitoso.");
            } catch (error) {
                console.error("Error Google Sign In:", error);
                showError("Fallo al iniciar sesi贸n con Google.");
            }
        }

        async function handleEmailAuth(e) {
            e.preventDefault();
            const email = e.target.email.value;
            const password = e.target.password.value;

            if (isSignInMode) {
                try {
                    await signInWithEmailAndPassword(auth, email, password);
                    showSuccess("Inicio de sesi贸n exitoso.");
                } catch (error) {
                    console.error("Error Sign In:", error);
                    showError("Error al iniciar sesi贸n: Credenciales incorrectas o usuario no encontrado.");
                }
            } else {
                try {
                    await createUserWithEmailAndPassword(auth, email, password);
                    showSuccess("Registro exitoso. 隆Bienvenido!");
                } catch (error) {
                    console.error("Error Sign Up:", error);
                    if (error.code === 'auth/weak-password') {
                        showError('La contrase帽a debe tener al menos 6 caracteres.');
                    } else if (error.code === 'auth/email-already-in-use') {
                        showError('Esa direcci贸n de correo ya est谩 registrada. Prueba a Iniciar Sesi贸n.');
                    } else {
                        showError("Fallo en el registro.");
                    }
                }
            }
        }

        async function handleSignOut() {
            try {
                await signOut(auth);
                showSuccess("Sesi贸n cerrada correctamente.");
            } catch (error) {
                console.error("Error al cerrar sesi贸n:", error);
                showError("Fallo al cerrar sesi贸n.");
            }
        }

        function handleAddToGoogleCalendar(e) {
            e.preventDefault();
            const time = document.getElementById('reminder-time').value;
            const frequency = parseInt(document.getElementById('reminder-frequency').value) || 1;
            
            if (!time || !frequency || !userId) {
                showError("Selecciona hora/frecuencia e inicia sesi贸n.");
                return;
            }

            const [hours, minutes] = time.split(':');
            let startDate = new Date();
            startDate.setHours(hours, minutes, 0, 0);
            if (new Date() > startDate) { startDate.setDate(startDate.getDate() + 1); }
            let endDate = new Date(startDate.getTime() + 15 * 60000); 

            const toUTCFormat = (date) => date.toISOString().replace(/-|:|\.\d+/g, '');
            const utcStartDate = toUTCFormat(startDate);
            const utcEndDate = toUTCFormat(endDate);

            const recurrenceRule = `RRULE:FREQ=DAILY;INTERVAL=${frequency}`;
            const title = encodeURIComponent("┖ Tomar Presi贸n Arterial");
            const details = encodeURIComponent("Recordatorio para registrar la presi贸n arterial.");
            const dates = `${utcStartDate}/${utcEndDate}`;

            const url = `https://www.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${dates}&details=${details}&recur=${recurrenceRule}&sf=true&output=xml`;
            window.open(url, '_blank');
        }

        function setupReadingsListener() {
            if (!userId) return;
            if (readingsListener) { readingsListener(); }

            loadingIndicator.classList.remove('hidden');
            
            // Ruta de la colecci贸n privada: /artifacts/{appId}/users/{userId}/bp_readings
            const collectionRef = collection(db, `artifacts/${CANVAS_APP_ID}/users/${userId}`, 'bp_readings');
            const q = query(collectionRef, orderBy("timestamp", "desc"));

            readingsListener = onSnapshot(q, (querySnapshot) => {
                loadingIndicator.classList.add('hidden');
                const readings = [];
                querySnapshot.forEach((doc) => {
                    readings.push({ id: doc.id, ...doc.data() });
                });
                currentReadings = readings;
                renderReadings(readings);
                updateChart(readings);
            }, (error) => {
                console.error("Error al escuchar mediciones. (REGLAS DE SEGURIDAD PROBABLEMENTE FALTAN):", error);
                showError("Error al cargar el historial. 隆Revisa las Reglas de Seguridad de Firestore!");
                loadingIndicator.classList.add('hidden');
            });
        }
        
        function renderReadings(readings) {
            historyContainer.innerHTML = '';
            if (readings.length === 0) {
                historyContainer.innerHTML = '<p class="text-gray-500 text-center">No hay mediciones guardadas. 隆Empieza a registrar datos!</p>';
                return;
            }

            readings.forEach(reading => {
                const card = document.createElement('div');
                const { categoryClass, categoryText } = getBpCategory(reading.systolic, reading.diastolic);
                
                // Asegurar que 'timestamp' es un objeto Timestamp antes de llamar a toDate()
                let date;
                if (reading.timestamp && typeof reading.timestamp.toDate === 'function') {
                    date = reading.timestamp.toDate();
                } else if (reading.timestamp instanceof Date) {
                    date = reading.timestamp;
                } else {
                    date = new Date(); // Fallback
                }
                
                const formattedDate = date.toLocaleString('es-ES', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });

                card.className = `relative p-4 rounded-lg shadow-md border-l-4 ${categoryClass.replace('border-', 'border-l-4 border-')}`;
                card.innerHTML = `
                    <button data-id="${reading.id}" class="delete-btn absolute top-2 right-2 text-gray-400 hover:text-red-600" title="Borrar">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-bold text-lg text-gray-800">${formattedDate}</span>
                        <span class="text-xs font-semibold px-2 py-0.5 rounded-full ${categoryClass.replace('border-', 'bg-').replace('-200', '-100').replace('bg-opacity-50', '')}">${categoryText}</span>
                    </div>
                    <div class="grid grid-cols-3 text-center">
                        <div><span class="text-sm text-gray-600">Sist贸lica</span><p class="text-2xl font-bold text-gray-900">${reading.systolic}</p></div>
                        <div><span class="text-sm text-gray-600">Diast贸lica</span><p class="text-2xl font-bold text-gray-900">${reading.diastolic}</p></div>
                        <div><span class="text-sm text-gray-600">Pulso</span><p class="text-2xl font-bold text-gray-900">${reading.pulse}</p></div>
                    </div>
                    ${reading.notes ? `<p class="mt-2 text-sm text-gray-700 italic"><strong>Notas:</strong> ${reading.notes}</p>` : ''}
                `;
                historyContainer.appendChild(card);
            });
        }

        function updateChart(readings) {
            const ctx = document.getElementById('bpChart').getContext('2d');
            if (bpChart) { bpChart.destroy(); }
            if (readings.length === 0) { return; }

            const chartReadings = [...readings].reverse();
            
            const labels = chartReadings.map(r => {
                let date;
                if (r.timestamp && typeof r.timestamp.toDate === 'function') {
                    date = r.timestamp.toDate();
                } else {
                    date = new Date(); // Fallback
                }
                return date.toLocaleString('es-ES', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit'});
            });

            const systolicData = chartReadings.map(r => r.systolic);
            const diastolicData = chartReadings.map(r => r.diastolic);
            const pulseData = chartReadings.map(r => r.pulse);

            bpChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'Sist贸lica', data: systolicData, borderColor: 'rgb(239, 68, 68)', backgroundColor: 'rgba(239, 68, 68, 0.1)', fill: false, tension: 0.1 },
                        { label: 'Diast贸lica', data: diastolicData, borderColor: 'rgb(59, 130, 246)', backgroundColor: 'rgba(59, 130, 246, 0.1)', fill: false, tension: 0.1 },
                        { label: 'Pulso', data: pulseData, borderColor: 'rgb(234, 179, 8)', backgroundColor: 'rgba(234, 179, 8, 0.1)', fill: false, tension: 0.1, hidden: true }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: false, suggestedMin: 50, suggestedMax: 160 } }, plugins: { tooltip: { mode: 'index', intersect: false }, legend: { position: 'top' } } }
            });
        }

        async function handleSaveReading(e) {
            e.preventDefault();
            if (!userId) { showError("Debes iniciar sesi贸n para guardar mediciones."); return; }

            const systolic = parseInt(form.systolic.value);
            const diastolic = parseInt(form.diastolic.value);
            const pulse = parseInt(form.pulse.value);
            const notes = form.notes.value;
            const readingTime = form['reading-time'].value;

            if (!systolic || !diastolic || !pulse || !readingTime) { showError("Por favor, completa todos los campos de medici贸n."); return; }
            
            // Convertir la cadena local de datetime-local a objeto Date y luego a Firebase Timestamp
            const localDate = new Date(readingTime);
            const timestamp = Timestamp.fromDate(localDate);

            try {
                const collectionRef = collection(db, `artifacts/${CANVAS_APP_ID}/users/${userId}`, 'bp_readings');
                await addDoc(collectionRef, { systolic, diastolic, pulse, notes, timestamp });
                showSuccess("Medici贸n guardada correctamente.");
                form.reset();
                setDefaultDateTime();
            } catch (error) {
                console.error("Error al guardar medici贸n:", error);
                showError("No se pudo guardar la medici贸n. Revisa las reglas de seguridad.");
            }
        }

        function handleExportPDF() {
            if (currentReadings.length === 0) { showError("No hay datos para exportar a PDF."); return; }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFontSize(18); doc.text("Historial de Presi贸n Arterial", 14, 22);
            doc.setFontSize(10); doc.text(`Exportado el: ${new Date().toLocaleString('es-ES')}`, 14, 28);
            if (userId && auth.currentUser) { doc.text(`Usuario: ${auth.currentUser.email || 'ID: ' + userId.substring(0, 10) + '...'}`, 14, 32); }

            const tableColumns = ["Fecha y Hora", "Sist贸lica", "Diast贸lica", "Pulso", "Notas"];
            const tableRows = [...currentReadings].reverse().map(reading => [
                reading.timestamp.toDate().toLocaleString('es-ES', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }),
                reading.systolic, reading.diastolic, reading.pulse, reading.notes || ""
            ]);

            doc.autoTable({ head: [tableColumns], body: tableRows, startY: 40, theme: 'striped', headStyles: { fillColor: [59, 130, 246] } });
            doc.save('historial_presion_arterial.pdf');
        }

        async function handleDeleteReading(id) {
            if (!userId || !id) return;
            try {
                const docRef = doc(db, `artifacts/${CANVAS_APP_ID}/users/${userId}/bp_readings`, id);
                await deleteDoc(docRef);
                showSuccess("Medici贸n borrada.");
            } catch (error) {
                console.error("Error al borrar medici贸n:", error);
                showError("No se pudo borrar la medici贸n.");
            }
        }

        function setDefaultDateTime() {
            const now = new Date();
            // Esto ajusta la hora para el input datetime-local correctamente
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            const localISO = now.toISOString().slice(0, 16);
            const readingTimeInput = document.getElementById('reading-time');
            if (readingTimeInput) readingTimeInput.value = localISO;
        }

        function getBpCategory(sys, dia) {
            if (sys > 180 || dia > 120) { return { categoryClass: 'border-red-700 bg-red-200 bg-opacity-50', categoryText: 'Crisis Hipertensiva' }; } 
            if (sys >= 140 || dia >= 90) { return { categoryClass: 'border-red-500 bg-red-200 bg-opacity-50', categoryText: 'Hipertensi贸n Nivel 2' }; } 
            if (sys >= 130 || dia >= 80) { return { categoryClass: 'border-orange-500 bg-orange-200 bg-opacity-50', categoryText: 'Hipertensi贸n Nivel 1' }; } 
            if (sys >= 120) { return { categoryClass: 'border-yellow-500 bg-yellow-200 bg-opacity-50', categoryText: 'Elevada' }; } 
            if (sys < 90 || dia < 60) { return { categoryClass: 'border-blue-400 bg-blue-200 bg-opacity-50', categoryText: 'Hipotensi贸n' }; } 
            return { categoryClass: 'border-green-500 bg-green-200 bg-opacity-50', categoryText: 'Normal' };
        }

        function showError(message) { errorMessage.textContent = message; errorMessage.classList.remove('hidden'); setTimeout(() => errorMessage.classList.add('hidden'), 4000); }
        function showSuccess(message) { successMessage.textContent = message; successMessage.classList.remove('hidden'); setTimeout(() => successMessage.classList.add('hidden'), 3000); }
    </script>
</head>
<body class="bg-gray-100 font-sans leading-normal tracking-normal min-h-screen">

    <div class="container mx-auto max-w-2xl p-4 md:p-6">
        
        <!-- Mensajes de estado -->
        <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative mb-4 shadow-lg" role="alert"></div>
        <div id="success-message" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg relative mb-4 shadow-lg" role="alert"></div>

        <!-- SECCIN DE AUTENTICACIN -->
        <section id="auth-section" class="flex flex-col items-center justify-center min-h-96">
            <div class="w-full max-w-sm bg-white p-8 rounded-xl shadow-2xl border border-gray-200">
                <h2 id="auth-title" class="text-3xl font-bold text-center text-blue-700 mb-6">Inicia Sesi贸n</h2>
                
                <button id="google-sign-in-btn" class="w-full flex items-center justify-center px-4 py-3 mb-4 text-white font-semibold rounded-lg shadow-md bg-red-500 hover:bg-red-600 transition duration-150">
                    <svg class="google-icon" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12.00 4.75a7.21 7.21 0 0 1 5.38 2.08l3.72-3.72C18.23 2.15 15.22 1 12.00 1 7.42 1 3.55 3.32 1.57 6.64l4.22 3.28C6.91 8.78 9.27 7.75 12.00 7.75z" fill="#fff"/><path d="M1.57 6.64c-.37 1.1-.58 2.29-.58 3.36 0 1.25.26 2.45.74 3.55l-4.22 3.28C3.55 20.68 7.42 22.00 12.00 22.00z" fill="#fff"/><path d="M12.00 22.00c3.7 0 6.94-1.44 9.5-3.83l-3.72-3.72c-1.39 1.14-3.15 1.83-5.78 1.83-2.92 0-5.5-1.29-7.27-3.46l-4.22 3.28C3.55 20.68 7.42 22.00 12.00 22.00z" fill="#fff"/><path d="M20.25 10.00c.09.68.14 1.37.14 2.00 0 1.94-.48 3.82-1.34 5.48l-4.22-3.28c.47-1.1.74-2.3.74-3.55 0-1.23-.21-2.42-.58-3.55l3.72-3.72c.86 1.48 1.34 3.1 1.34 4.87z" fill="#fff"/></svg>
                    Continuar con Google
                </button>

                <div class="relative flex items-center py-5"><div class="flex-grow border-t border-gray-300"></div><span class="flex-shrink mx-4 text-gray-400">O con tu Email</span><div class="flex-grow border-t border-gray-300"></div></div>

                <!-- Formulario de Email/Password -->
                <form id="email-auth-form" class="space-y-4">
                    <div><input type="email" name="email" placeholder="Correo Electr贸nico" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" autocomplete="email"></div>
                    <div><input type="password" name="password" placeholder="Contrase帽a (m铆n. 6 caracteres)" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" autocomplete="current-password"></div>
                    <button id="email-auth-submit" type="submit" class="w-full px-4 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition duration-150">Iniciar Sesi贸n</button>
                </form>

                <div class="mt-6 text-center">
                    <button id="switch-auth-btn" class="text-sm text-blue-600 hover:text-blue-800 transition duration-150">驴No tienes cuenta? Reg铆strate aqu铆.</button>
                </div>
            </div>
        </section>


        <!-- CONTENIDO PRINCIPAL DE LA APP -->
        <div id="app-content" class="hidden hidden-transition">
            <!-- Cabecera -->
            <header class="mb-6 flex justify-between items-center bg-white p-4 rounded-xl shadow-md sticky top-0 z-10 border-b border-gray-200">
                <div>
                    <h1 class="text-xl font-bold text-blue-700">┖ Registro BP</h1>
                    <p class="text-xs text-gray-600 truncate">Usuario: <span id="user-email-display" class="font-semibold"></span></p>
                </div>
                <button id="sign-out-btn" class="px-3 py-1 bg-red-500 text-white text-sm font-medium rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500">
                    Salir
                </button>
            </header>

            <!-- Secci贸n de Recordatorio -->
            <section class="mb-6 bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-xl font-semibold mb-3 text-gray-800">Recordatorio Peri贸dico</h2>
                <form id="reminder-form" class="grid grid-cols-1 sm:grid-cols-3 gap-4 items-end">
                    <div><label for="reminder-time" class="block text-sm font-medium text-gray-700">Hora:</label><input type="time" id="reminder-time" name="reminder-time" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"></div>
                    <div><label for="reminder-frequency" class="block text-sm font-medium text-gray-700">Cada (d铆as):</label><input type="number" id="reminder-frequency" name="reminder-frequency" value="1" min="1" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"></div>
                    <div class="sm:col-span-1"><button id="add-to-calendar-btn" type="button" class="w-full px-4 py-2 bg-green-600 text-white font-semibold rounded-md shadow-sm hover:bg-green-700 focus:ring-2 focus:ring-green-500">A帽adir a G. Calendar</button></div>
                </form>
            </section>

            <!-- Secci贸n de Formulario de Registro -->
            <section class="mb-6 bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Registrar Nueva Medici贸n</h2>
                <form id="bp-form" class="space-y-4">
                    <div class="grid grid-cols-3 gap-4">
                        <div><label for="systolic" class="block text-sm font-medium text-gray-700">Sist贸lica (SYS)</label><input type="number" id="systolic" name="systolic" placeholder="Ej: 120" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"></div>
                        <div><label for="diastolic" class="block text-sm font-medium text-gray-700">Diast贸lica (DIA)</label><input type="number" id="diastolic" name="diastolic" placeholder="Ej: 80" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"></div>
                        <div><label for="pulse" class="block text-sm font-medium text-gray-700">Pulso (PPM)</label><input type="number" id="pulse" name="pulse" placeholder="Ej: 70" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"></div>
                    </div>
                    <div><label for="reading-time" class="block text-sm font-medium text-gray-700">Fecha y Hora</label><input type="datetime-local" id="reading-time" name="reading-time" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"></div>
                    <div><label for="notes" class="block text-sm font-medium text-gray-700">Notas (opcional)</label><textarea id="notes" name="notes" rows="2" placeholder="Ej: Despu茅s de caminar..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"></textarea></div>
                    <div><button type="submit" class="w-full px-4 py-2 bg-green-600 text-white font-semibold rounded-md shadow-sm hover:bg-green-700 focus:ring-2 focus:ring-green-500">Guardar Medici贸n</button></div>
                </form>
            </section>

            <!-- Secci贸n de Gr谩fico -->
            <section class="mb-6 bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Gr谩fico de Seguimiento</h2>
                <div class="relative h-80"><canvas id="bpChart"></canvas></div>
            </section>

            <!-- Secci贸n de Historial -->
            <section class="bg-white p-6 rounded-xl shadow-md">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">Historial de Mediciones</h2>
                    <button id="export-pdf-btn" class="px-3 py-1 bg-gray-200 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-300 focus:ring-2 focus:ring-gray-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block -mt-0.5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>Exportar a PDF
                    </button>
                </div>
                <div id="loading" class="text-center text-gray-500 p-4"><p>Cargando mediciones...</p></div>
                <div id="history-container" class="space-y-4"></div>
            </section>
        </div>
    </div>
</body>
</html>
